<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <title>Saphety Phishing Campaign - H4ndSH</title><meta name="Description" content="This article is about a phishing campaign that I found in the wild. The phishing campaign was targeting Saphety, a Portuguese company that provides electronic invoicing services."><meta property="og:title" content="Saphety Phishing Campaign" />
<meta property="og:description" content="This article is about a phishing campaign that I found in the wild. The phishing campaign was targeting Saphety, a Portuguese company that provides electronic invoicing services." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://h4ndsh.github.io/2023/saphety/" /><meta property="og:image" content="https://h4ndsh.github.io/2023/saphety/featured-image.png" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-06-29T00:00:00+00:00" />
<meta property="article:modified_time" content="2023-06-29T00:00:00+00:00" /><meta property="og:site_name" content="H4ndSH" />

<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="https://h4ndsh.github.io/2023/saphety/featured-image.png" /><meta name="twitter:title" content="Saphety Phishing Campaign"/>
<meta name="twitter:description" content="This article is about a phishing campaign that I found in the wild. The phishing campaign was targeting Saphety, a Portuguese company that provides electronic invoicing services."/>
<meta name="twitter:site" content="@h4ndsh"/>
<meta name="application-name" content="H4ndSH">
<meta name="apple-mobile-web-app-title" content="H4ndSH"><meta name="theme-color" content="#ffffff"><meta name="msapplication-TileColor" content="#55309b"><link rel="icon" href="https://avatars.githubusercontent.com/u/26088700?v=4"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#55309b"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="https://h4ndsh.github.io/2023/saphety/" /><link rel="prev" href="https://h4ndsh.github.io/2023/myresources/" /><link rel="next" href="https://h4ndsh.github.io/2023/phpinfo/" /><link rel="stylesheet" href="/css/style.min.49d6f433b0314fb247b1fe7c43de5820e7f136c1e1b94857d70d5de395a493e0bab1420b847934ca1c74f3cc8da6b9555719a906706dd7588919c735b9625e97.css" integrity="sha512-Sdb0M7AxT7JHsf58Q95YIOfxNsHhuUhX1w1d45Wkk+C6sUILhHk0yhx088yNprlVVxmpBnBt11iJGcc1uWJelw=="><link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css"></noscript><link rel="preload" href="https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css"></noscript><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "Saphety Phishing Campaign",
        "inLanguage": "en",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:\/\/h4ndsh.github.io\/2023\/saphety\/"
        },"image": [{
                            "@type": "ImageObject",
                            "url": "https:\/\/h4ndsh.github.io\/2023\/saphety\/featured-image.png",
                            "width":  1200 ,
                            "height":  480 
                        }],"genre": "posts","keywords": "Ethical Hacking, Phishing, Saphety","wordcount":  711 ,
        "url": "https:\/\/h4ndsh.github.io\/2023\/saphety\/","datePublished": "2023-06-29T00:00:00+00:00","dateModified": "2023-06-29T00:00:00+00:00","license": "This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.","publisher": {
            "@type": "Organization",
            "name": ""},"author": {
                "@type": "Person",
                "name": "h4ndsh"
            },"description": "This article is about a phishing campaign that I found in the wild. The phishing campaign was targeting Saphety, a Portuguese company that provides electronic invoicing services."
    }
    </script></head>
    <body data-header-desktop="fixed" data-header-mobile="auto"><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('dark' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'dark' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="H4ndSH">H4ndSH</a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/posts/"> All Posts </a><a class="menu-item" href="/about/" title="About Me"> About </a><a class="menu-item" href="/vuln/" title="Vulnerabilities"><i class='fa fa-trophy fa-fw' style='color:#ffd700;' aria-hidden='true'></i>  </a><a class="menu-item" href="https://github.com/h4ndsh" title="GitHub" rel="noopener noreffer" target="_blank"><i class='fab fa-github fa-fw' aria-hidden='true'></i>  </a><span class="menu-item delimiter"></span><span class="menu-item search" id="search-desktop">
                        <input type="text" placeholder="Search titles or contents..." id="search-input-desktop">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="Search">
                            <i class="fas fa-search fa-fw" aria-hidden="true"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="Clear">
                            <i class="fas fa-times-circle fa-fw" aria-hidden="true"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-desktop">
                            <i class="fas fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
                        </span>
                    </span><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                    <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
                </a></div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="H4ndSH">H4ndSH</a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><div class="search-wrapper">
                    <div class="search mobile" id="search-mobile">
                        <input type="text" placeholder="Search titles or contents..." id="search-input-mobile">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="Search">
                            <i class="fas fa-search fa-fw" aria-hidden="true"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="Clear">
                            <i class="fas fa-times-circle fa-fw" aria-hidden="true"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-mobile">
                            <i class="fas fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
                        </span>
                    </div>
                    <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">
                        Cancel
                    </a>
                </div><a class="menu-item" href="/posts/" title="">All Posts</a><a class="menu-item" href="/about/" title="About Me">About</a><a class="menu-item" href="/vuln/" title="Vulnerabilities"><i class='fa fa-trophy fa-fw' style='color:#ffd700;' aria-hidden='true'></i></a><a class="menu-item" href="https://github.com/h4ndsh" title="GitHub" rel="noopener noreffer" target="_blank"><i class='fab fa-github fa-fw' aria-hidden='true'></i></a><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
            </a></div>
    </div>
</header><div class="search-dropdown desktop">
        <div id="search-dropdown-desktop"></div>
    </div>
    <div class="search-dropdown mobile">
        <div id="search-dropdown-mobile"></div>
    </div><main class="main">
                <div class="container"><article class="page single"><h1 class="single-title animate__animated animate__flipInX">Saphety Phishing Campaign</h1><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="https://h4ndsh.github.io" title="Author" target="_blank" rel="noopener noreffer author" class="author"><i class="fas fa-user-circle fa-fw" aria-hidden="true"></i>h4ndsh</a></span>&nbsp;<span class="post-category">included in <a href="/categories/phishing/"><i class="far fa-folder fa-fw" aria-hidden="true"></i>Phishing</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw" aria-hidden="true"></i>&nbsp;<time datetime="Jun 29, 2023">Jun 29, 2023</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden="true"></i>&nbsp;711 words&nbsp;
                <i class="far fa-clock fa-fw" aria-hidden="true"></i>&nbsp;4 minutes&nbsp;</div>
        </div><div class="featured-image"><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/2023/saphety/featured-image.png"
        data-srcset="/2023/saphety/featured-image.png, /2023/saphety/featured-image.png 1.5x, /2023/saphety/featured-image.png 2x"
        data-sizes="auto"
        alt="/2023/saphety/featured-image.png"
        title="This article is about a phishing campaign that I found in the wild. The phishing campaign was targeting Saphety, a Portuguese company that provides electronic invoicing services." /></div><div class="content" id="content"><p>This article is about a phishing campaign that my company received. The campaign targeted Saphety, a Portuguese company providing electronic invoicing services. When my enterprise received the phishing email, I decided to investigate further. In this article, I will share my findings.</p>
<h1 id="summary">Summary</h1>
<ul>
<li><a href="#summary" rel="">Summary</a></li>
<li><a href="#what-is-saphety" rel="">What is Saphety?</a></li>
<li><a href="#the-phishing-email" rel="">The phishing email</a></li>
<li><a href="#website-analysis" rel="">Website analysis</a>
<ul>
<li><a href="#decoding-the-encoded-strings" rel="">Decoding the encoded strings</a></li>
<li><a href="#form-analysis" rel="">Form analysis</a></li>
<li><a href="#post-method-analysis" rel="">POST method analysis</a></li>
<li><a href="#server-analysis" rel="">Server analysis</a></li>
</ul>
</li>
</ul>
<h1 id="what-is-saphety">What is Saphety?</h1>
<p>Saphety is a Portuguese company that offers electronic invoicing services. It serves a wide range of clients, including some of the largest companies in Portugal, as well as clients in other countries such as Spain, France, and Brazil.</p>
<h1 id="the-phishing-email">The phishing email</h1>
<p>The phishing email was sent from the email address <code>info@cabinetconstruction.com</code> with the subject line: &ldquo;Cristina Campos sent you an electronic document.&rdquo; The email body contained the following message:</p>
<p><figure><a class="lightgallery" href="/2023/saphety/email-body.png" title="Email Body" data-thumbnail="/2023/saphety/email-body.png" data-sub-html="<h2>Email Body</h2><p>Email Body</p>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/2023/saphety/email-body.png"
            data-srcset="/2023/saphety/email-body.png, /2023/saphety/email-body.png 1.5x, /2023/saphety/email-body.png 2x"
            data-sizes="auto"
            alt="/2023/saphety/email-body.png" width="745" height="789" />
    </a><figcaption class="image-caption">Email Body</figcaption>
    </figure></p>
<p>The email impersonated Saphety, and it also included a link to a phishing website. I will not share the link here, as it has likely been taken down. However, I will provide some screenshots of the phishing website.</p>
<h1 id="website-analysis">Website analysis</h1>
<p>The phishing website was hosted on Cloudflare and utilized a valid SSL certificate. It was hosted on the domain <code>cf-ipfs.com</code>, which was registered on 2018-12-05.</p>
<h2 id="decoding-the-encoded-strings">Decoding the encoded strings</h2>
<p>Upon examining the phishing website&rsquo;s code, I discovered that it was encoded using the <code>escape</code> function, an old JavaScript method used to encode strings. The website also employed various JavaScript obfuscation techniques, such as utilizing random variable names and splitting the code into multiple lines. The following screenshot shows the encoded strings.</p>
<p><figure><a class="lightgallery" href="/2023/saphety/html-script.png" title="Script" data-thumbnail="/2023/saphety/html-script.png" data-sub-html="<h2>Html Script</h2><p>Script</p>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/2023/saphety/html-script.png"
            data-srcset="/2023/saphety/html-script.png, /2023/saphety/html-script.png 1.5x, /2023/saphety/html-script.png 2x"
            data-sizes="auto"
            alt="/2023/saphety/html-script.png" width="1136" height="379" />
    </a><figcaption class="image-caption">Html Script</figcaption>
    </figure></p>
<p>To decode the encoded strings, I used the <code>unescape</code> function and printed the decoded strings to the console. This allowed me to understand the actions performed by the website.</p>
<h2 id="form-analysis">Form analysis</h2>
<p>The phishing website employed a form to collect data and send it to the hacker&rsquo;s domain. The form used by the hackers was similar to those I have encountered in previous phishing websites. The form was designed to mimic the victim&rsquo;s domain and generate fake webmail login pages. In the background, the phishing website loaded the main phishing page from the victim&rsquo;s domain, with the victim&rsquo;s domain name being used to generate the fake webmail login pages.</p>
<p><figure><a class="lightgallery" href="/2023/saphety/form.png" title="Form" data-thumbnail="/2023/saphety/form.png" data-sub-html="<h2>Form</h2><p>Form</p>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/2023/saphety/form.png"
            data-srcset="/2023/saphety/form.png, /2023/saphety/form.png 1.5x, /2023/saphety/form.png 2x"
            data-sizes="auto"
            alt="/2023/saphety/form.png" width="721" height="459" />
    </a><figcaption class="image-caption">Form</figcaption>
    </figure></p>
<p>Thus far, there was nothing particularly distinct about this phishing website compared to others I have encountered in the past. I needed to dig deeper to understand its full operation. Where was the data being sent? What was the phishing website doing with the data? The answers to these questions lay within the POST method.</p>
<h2 id="post-method-analysis">POST method analysis</h2>
<p>To uncover the actions of the phishing website, I needed to determine where the data was being sent. For that purpose, I searched for the POST method in the phishing website&rsquo;s code.</p>
<p><figure><a class="lightgallery" href="/2023/saphety/post.png" title="POST" data-thumbnail="/2023/saphety/post.png" data-sub-html="<h2>POST</h2><p>POST</p>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/2023/saphety/post.png"
            data-srcset="/2023/saphety/post.png, /2023/saphety/post.png 1.5x, /2023/saphety/post.png 2x"
            data-sizes="auto"
            alt="/2023/saphety/post.png" width="761" height="240" />
    </a><figcaption class="image-caption">POST</figcaption>
    </figure></p>
<p>As seen in the screenshot, the POST method was used to send the data to the hacker&rsquo;s domain in JSON format via the cp.php file. My curiosity was piqued by the <code>cp.php</code> file, so I decided to investigate it further, and what I found was quite interesting.</p>
<h2 id="server-analysis">Server analysis</h2>
<p>As you may know, we are unable to access the server code directly. However, we can try to view directories and files that are not protected by the server. In this case, the hacker&rsquo;s server was not properly protected, allowing me to view the directories and files hosted on it. It was there that I stumbled upon some intriguing directories and files.</p>
<p><figure><a class="lightgallery" href="/2023/saphety/dir.png" title="First Directory" data-thumbnail="/2023/saphety/dir.png" data-sub-html="<h2>First Directory</h2><p>First Directory</p>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/2023/saphety/dir.png"
            data-srcset="/2023/saphety/dir.png, /2023/saphety/dir.png 1.5x, /2023/saphety/dir.png 2x"
            data-sizes="auto"
            alt="/2023/saphety/dir.png" width="1872" height="408" />
    </a><figcaption class="image-caption">First Directory</figcaption>
    </figure>
<figure><a class="lightgallery" href="/2023/saphety/dir2.png" title="Second Directory" data-thumbnail="/2023/saphety/dir2.png" data-sub-html="<h2>First Directory</h2><p>Second Directory</p>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/2023/saphety/dir2.png"
            data-srcset="/2023/saphety/dir2.png, /2023/saphety/dir2.png 1.5x, /2023/saphety/dir2.png 2x"
            data-sizes="auto"
            alt="/2023/saphety/dir2.png" width="1872" height="408" />
    </a><figcaption class="image-caption">First Directory</figcaption>
    </figure></p>
<p>One file, in particular, caught my attention: <code>ahmed.txt</code>. I decided to open it and see its contents, and to my surprise, I discovered a multitude of email addresses and passwords. I was reluctant to believe that the credentials were being stored in a plain text file. To confirm my suspicions, I conducted a test POST request to see if the credentials were indeed being saved in the text file, and unfortunately, they were.</p>
<p><figure><a class="lightgallery" href="/2023/saphety/credentials.png" title="POST Request Test" data-thumbnail="/2023/saphety/credentials.png" data-sub-html="<h2>POST Request Test</h2><p>POST Request Test</p>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/2023/saphety/credentials.png"
            data-srcset="/2023/saphety/credentials.png, /2023/saphety/credentials.png 1.5x, /2023/saphety/credentials.png 2x"
            data-sizes="auto"
            alt="/2023/saphety/credentials.png" width="626" height="188" />
    </a><figcaption class="image-caption">POST Request Test</figcaption>
    </figure></p>
<p>Clear and simple.</p>
<center>
  <img src="https://media0.giphy.com/media/v1.Y2lkPTc5MGI3NjExZmZ3ZjM4Zmc4cHF0eGNoZm1nY2gzNzdlc3JyaHlzMTJrd3kwNmV4byZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/9lusxBBUsTz8Fk029b/giphy.gif" width="60%" height="60%" class="center"/>
</center>
<p>The inevitable had occurred. I had access to the victims&rsquo; credentials, numerous credentials in fact. I promptly reported the phishing website to Cloudflare and the victim company.</p>
<p>At the time of writing this article, the phishing website had been reported as such.
<figure><a class="lightgallery" href="/2023/saphety/reported.png" title="Reported" data-thumbnail="/2023/saphety/reported.png" data-sub-html="<h2>Reported Message</h2><p>Reported</p>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/2023/saphety/reported.png"
            data-srcset="/2023/saphety/reported.png, /2023/saphety/reported.png 1.5x, /2023/saphety/reported.png 2x"
            data-sizes="auto"
            alt="/2023/saphety/reported.png" width="754" height="240" />
    </a><figcaption class="image-caption">Reported Message</figcaption>
    </figure></p>
<p>That concludes this article. I hope you found it informative.</p>
<p>Happy Researching! &#x1f604;</p>
</div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>Updated on Jun 29, 2023</span>
            </div></div>
        <div class="post-info-line">
            <div class="post-info-md"></div>
            <div class="post-info-share">
                <span></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw" aria-hidden="true"></i>&nbsp;<a href="/tags/ethical-hacking/">Ethical Hacking</a>,&nbsp;<a href="/tags/phishing/">Phishing</a>,&nbsp;<a href="/tags/saphety/">Saphety</a></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">Back</a></span>&nbsp;|&nbsp;<span><a href="/">Home</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/2023/myresources/" class="prev" rel="prev" title="My resources to learn Ethical Hacking"><i class="fas fa-angle-left fa-fw" aria-hidden="true"></i>My resources to learn Ethical Hacking</a>
            <a href="/2023/phpinfo/" class="next" rel="next" title="PHP &lt;= 7.3 Local File Inclusion with RCE (PoC)">PHP <= 7.3 Local File Inclusion with RCE (PoC)<i class="fas fa-angle-right fa-fw" aria-hidden="true"></i></a></div>
</div>
</article></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line">Powered by <a href="https://gohugo.io/" target="_blank" rel="noopener noreffer" title="Hugo 0.123.7">Hugo</a> | Theme - <a href="https://github.com/dillonzq/LoveIt" target="_blank" rel="noopener noreffer" title="LoveIt 0.2.11"><i class="far fa-kiss-wink-heart fa-fw" aria-hidden="true"></i> LoveIt</a>
                </div><div class="footer-line" itemscope itemtype="http://schema.org/CreativeWork"></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="Back to Top">
                <i class="fas fa-arrow-up fa-fw" aria-hidden="true"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="View Comments">
                <i class="fas fa-comment fa-fw" aria-hidden="true"></i>
            </a>
        </div><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/autocomplete.js@0.38.1/dist/autocomplete.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/algoliasearch@4.13.1/dist/algoliasearch-lite.umd.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lazysizes@5.3.2/lazysizes.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"Copy to clipboard","maxShownLines":50},"comment":{},"search":{"algoliaAppID":"PASDMWALPK","algoliaIndex":"index.en","algoliaSearchKey":"b42948e51daaa93df92381c8e2ac0f93","highlightTag":"em","maxResultLength":10,"noResultsFound":"No results found","snippetLength":30,"type":"algolia"}};</script><script type="text/javascript" src="/js/theme.min.f1b10c54ef8e7ea0c938baba89a68e47962cb91f87edfcf0ae7abf0ec7bbb510e5d980a2b5a69686d7a44eae747183e3ed5cd960ed6fe66552c947e6fca4ff67.js" integrity="sha512-8bEMVO+OfqDJOLq6iaaOR5YsuR+H7fzwrnq/Dse7tRDl2YCitaaWhtekTq50cYPj7VzZYO1v5mVSyUfm/KT/Zw=="></script></body>
</html>
